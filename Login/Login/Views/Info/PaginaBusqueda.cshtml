@*
    @{
        Layout = "~/Views/Shared/_LayoutStatista.cshtml";
    }
*@

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <!--Meta Tags-->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--Bundles rederizados-->
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @*fontawesome*@
    <script src="https://kit.fontawesome.com/2f08016506.js" crossorigin="anonymous"></script>
    <link href="~/Content/font-awesome.min.css" rel="stylesheet" />
    @*estilos*@
    <link href="~/Content/EstilosPopUp.css" rel="stylesheet" />
    <link href="~/Content/StylePagBusqueda.css" rel="stylesheet" />
    @*Titulo de la pagina*@
    <title>Estadística</title>
    @*Script para cargar charts*@
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--carrucel-->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <!-- pdf descargar-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--megamenu-->
    <script>
        $(document).ready(function () {
            $(".megamenu").on("click", function (e) {
                e.stopPropagation();
            });
        });

    </script>

</head>
<body>
    @*Menu principal*@


    <div class="container mt-5" style="margin-top:100px;">
        <h2>Resultados de la búsqueda</h2>
        <div class="row">
            <!-- Comienzo de rsultados de Busqueda -->
            <div class="col-md-12">
                <div class="grid search">
                    <div class="grid-body">
                        <!-- Comienzo de Fila que contiene botón borrar filtro y buscador -->
                        <div class="row mt-5">
                            <div class="col-md-3 text-center">
                                <button type="button" class="btn btn-secondary" style="border-radius:10px;">Borrar filtro</button>
                            </div>
                            <div class="col-md-9 pr-0">
                                <div class="p-1 bg-light rounded-pill shadow-sm mb-4" style="border:solid; border-radius:20px;">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <button id="button-addon2" type="submit" class="btn btn-link text-dark"><i class="fa fa-search"></i></button>
                                        </div>
                                        <input id="search" type="search" placeholder="Búsqueda por palabras claves" aria-describedby="button-addon2" class="form-control rounded rounded-pill border-0 bg-light">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Final de Fila que contiene botón borrar filtro y buscador -->
                        <div class="row" style="border:hidden !important;">
                            <!-- Comienzo filtros -->

                            <div class="tags col-md-3 " style="border:solid; border-radius:20px;  padding-top:12px;">


                                @*Este script es para hacer el filtro de la tabla*@
                                <script>
                                    $(document).ready(function () {
                                        $(".name").on("click", function () {
                                            $('.pagination').html('')
                                            $('#paginador').html('')
                                            var trnum = 1;
                                            var maxRows = 10;
                                            var totalRows = $(table + ' tbody tr').length
                                            name_list = []
                                            $("#myTable tr").hide()
                                            var flag = 1
                                            $("input:checkbox[name=name]:checked").each(function () {
                                                flag = 0;
                                                var value = $(this).val().toLowerCase();
                                                $("#myTable tr").filter(function () {
                                                    //trnum++;
                                                    if ($(this).text().toLowerCase().indexOf(value) > -1) {
                                            //             $(this).show()
                                                        if (trnum > maxRows) {
                                                         $(this).hide()

                                                        
                                                        }
                                                        if (trnum <= maxRows) {
                                                        $(this).show()

                                                        
                                                        }
                                                        trnum++;
                                                    }
                                                });
                                            });

                                            if (flag == 1) {                                               
                                                $("#myTable tr").show()
                                                var p = new Paginador(
                                                    document.getElementById('paginador'),
                                                    document.getElementById('mytable'),
                                                    10
                                                );
                                                p.Mostrar();
                                            }
                                            //
                                            @*
                                            $('.pagination').html('')
                                            var trnum = 0;
                                            var maxRows = 10;
                                            var totalRows = $(table + ' tbody tr').length
                                            $(table + ' tr:gt(0)').each(function () {
                                                trnum++
                                                alert($(this).text())
                                                if (trnum > maxRows) {
                                                    $(this).hide()
                                                }
                                                if (trnum <= maxRows) {
                                                    $(this).show()
                                                }
                                            })
                                            if (totalRows > maxRows) {
                                                var pagenum = Math.ceil(totalRows / maxRows)
                                                for (var i = 1; i <= pagenum;) {
                                                    $('.pagination').append('<li class="btn" data-page="' + i + '">\<span>' + i++ + '<span class="page-item  sr-only">(current)</span></span>\</li>').show()
                                                }
                                            } 
                                                *@
                                        });
                                    });
                                </script>
                                
                                @*Este script es para hacer el filtro de la tabla*@
                                <!-- Comienzo filtros por Pais-->
                                <h4>TIPO DE INFORMACIÓN</h4>
                                <div>
                                    @foreach (var item7 in ViewBag.TipoGrafico)
                                    {
                                        <div>
                                            <label><input type="checkbox" class="name" name="name" value="@item7"> @item7</label>
                                        </div>
                                    }
                                </div>
                                <h4>COBERTURA</h4>
                                <div style="overflow:scroll; height:380px; overflow-x:hidden;">
                                    @foreach (var item in ViewBag.Paises)
                                    {
                                        <div>
                                            <label><input type="checkbox" class="name" name="name" value="@item"> @item</label>
                                        </div>
                                    }
                                </div>
                                <!-- FINAL DE FILTROS POR CATEGORY -->

                                <div class="padding"></div>

                                <!-- COMIENZO DE FILTROS POR ANIO -->
                                @*
        <h4>Temporalidad:</h4>

        @foreach (var item2 in ViewBag.Temporalidad)
        {
            <div class="checkbox">
                <label><input type="checkbox" class="name icheck" name="name" value="@item2"> @item2</label>
            </div>
        }

        <!-- FINAL FILTROS POR ANIO -->
        <div class="padding"></div>

        <!-- COMIENZO FILTROS POR INDUSTRIA -->
        <h4>Industria:</h4>
        @foreach (var item5 in ViewBag.Industria)
        {
            <div class="checkbox">
                <label><input type="checkbox" class="name icheck" name="name" value="@item5"> @item5</label>
            </div>
        }

        <!-- FINAL DE FILTRO POR INDUSTRIA -->
        <div class="padding"></div>
        <!-- COMIENZO FILTROS POR SECTOR -->
        <h4>Sector:</h4>
        @foreach (var item4 in ViewBag.Sector)
        {
            <div class="checkbox">
                <label><input type="checkbox" class="name icheck" name="name" value="@item4"> @item4</label>
            </div>
        }

        <!-- FINAL FILTROS POR SECTOR -->
        <div class="padding"></div>
        <!-- COMIENZO FILTROS POR PRODUCTO -->
        <h4>Producto:</h4>
        @foreach (var item2 in ViewBag.Producto)
        {
            <div class="checkbox">
                <label><input type="checkbox" class="name icheck" name="name" value="@item2"> @item2</label>
            </div>
        }

        <!-- FINAL FILTROS POR PRODUCTO -->
        <div class="padding"></div>
                                    *@
        <!-- COMIENZO FILTROS POR CATEGORIA -->
        <h4>Categoria:</h4>
        @foreach (var item6 in ViewBag.Categoria)
        {
            <div class="checkbox">
                <label><input type="checkbox" class="name icheck" name="name" value="@item6"> @item6</label>
            </div>
        }

        <!-- FINAL FILTROS POR CATEGORIA -->
                                
                                @*
            <div class="padding"></div>

            <!-- FILTROS POR FECHA -->

            <h4>Por fecha:</h4>

            <div class="container">
                <div class="row">
                    <div class="col-12">
                        Fecha inicial:
                    </div>
                    <input id="startDate" width="220" />
                    <div class="col-12">
                        Fecha término:
                    </div>
                    <input id="endDate" width="220" />
                </div>
            </div>
            <script>
                var today = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());
                $('#startDate').datepicker({
                    uiLibrary: 'bootstrap4',
                    iconsLibrary: 'fontawesome',
                    minDate: today,
                    maxDate: function () {
                        return $('#endDate').val();
                    }
                });
                $('#endDate').datepicker({
                    uiLibrary: 'bootstrap4',
                    iconsLibrary: 'fontawesome',
                    minDate: function () {
                        return $('#startDate').val();
                    }
                });
            </script>
            <!-- FINAL FILTROS POR FECHA -->

            <div class="padding"></div>

            <!-- COMIENZO FILTRO POR PRECIOS -->
            <h4>Por precio:</h4>
            Entre <div id="price1">$300</div> y <div id="price2">$800</div>
            <div class="slider-primary">
                <div class="slider slider-horizontal" style="width: 152px;"><div class="slider-track"><div class="slider-selection" style="left: 30%; width: 50%;"></div><div class="slider-handle round" style="left: 30%;"></div><div class="slider-handle round" style="left: 80%;"></div></div><div class="tooltip top hide" style="top: -30px; left: 50.1px;"><div class="tooltip-arrow"></div><div class="tooltip-inner">300 : 800</div></div><input type="text" class="slider" value="" data-slider-min="0" data-slider-max="1000" data-slider-step="1" data-slider-value="[300,800]" data-slider-tooltip="hide"></div>
            </div>
            <!-- FINAL FILTROS POR PRECIOS -->
        </div>
        <!-- FINAL FILTROS -->
                                *@
                            </div>
                            <!-- COMIENZO RESULTADOS -->
                            <div class="col-md-9 pr-0">


                                @*
        <div class="padding"></div>

        <div class="row">
            <!-- COMIENZO ORDENAR RESULTADOS -->
            <div class="col-sm-6">

            </div>
            <!-- FINAL ORDENAR RESULTADOS -->

            <div class="col-md-6 text-right">

            </div>
        </div>
                                *@
                                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
                                <script>
                                    // Write on keyup event of keyword input element
                                    $(document).ready(function () {
                                        $("#search").keyup(function () {
                                            _this = this;
                                            // Show only matching TR, hide rest of them
                                            $.each($("#mytable tbody tr"), function () {
                                                if ($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase()) === -1)
                                                    $(this).hide();
                                                else
                                                    $(this).show();
                                            });
                                        });
                                    });
                                </script>

                                <!-- COMIENZO TABLA RESULTADOS -->
                                <div class="table-responsive display" style="border:solid; border-radius:20px !important; padding-left:15px;">
                                    <table id="mytable" class="table table-borderless">

                                        <thead id="stud_body">
                                            <tr>
                                                <th>NOMBRE</th>
                                            </tr>
                                        </thead>
                                        <tbody id="myTable" style="border: none !important;">
                                            @foreach (var item in ViewBag.Resultado)
                                            {
                                                <tr>
                                                    <td style="border-top:hidden !important;">
                                                        <a href="~/info/index?id=@item.id" target="_blank">
                                                            @item.nombre <br /> @item.TIPO_GRAFICO_id @item.TIPO_GRAFICO.nombre
                                                            <p style="display:none;">@item.TERRITORIO.nombre </p>
                                                        </a>
                                                        @item.TEMPORALIDAD.nombre

                                                    </td>
                                                </tr>
                                            }
                                        </tbody>

                                    </table>
                                    <!--script1 para la paginacion-->
                                    <script type="text/javascript">
                                        Paginador = function (divPaginador, tabla, tamPagina) {
                                            this.miDiv = divPaginador; //un DIV donde irán controles de paginación
                                            this.tabla = tabla;           //la tabla a paginar
                                            this.tamPagina = tamPagina; //el tamaño de la página (filas por página)
                                            this.pagActual = 1;         //asumiendo que se parte en página 1
                                            this.paginas = Math.floor((this.tabla.rows.length - 1) / this.tamPagina); //¿?

                                            this.SetPagina = function (num) {
                                                if (num < 0 || num > this.paginas)
                                                    return;

                                                this.pagActual = num;
                                                var min = 1 + (this.pagActual - 1) * this.tamPagina;
                                                var max = min + this.tamPagina - 1;

                                                for (var i = 1; i < this.tabla.rows.length; i++) {
                                                //alert(this.tabla.rows[i].innerText)
                                                    if (i < min || i > max)
                                                        this.tabla.rows[i].style.display = 'none';
                                                    else
                                                        this.tabla.rows[i].style.display = '';
                                                }
                                                this.miDiv.firstChild.rows[0].cells[1].innerHTML = this.pagActual;
                                            }

                                            this.Mostrar = function () {
                                                //Crear la tabla
                                                var tblPaginador = document.createElement('table');

                                                //Agregar una fila a la tabla
                                                var fil = tblPaginador.insertRow(tblPaginador.rows.length);

                                                //Ahora, agregar las celdas que serán los controles
                                                var ant = fil.insertCell(fil.cells.length);
                                                ant.innerHTML = 'Anterior ';
                                                ant.className = 'pag_btn btn-primary'; //con eso le asigno un estilo
                                                var self = this;
                                                ant.onclick = function () {
                                                    if (self.pagActual == 1)
                                                        return;
                                                    self.SetPagina(self.pagActual - 1);
                                                }

                                                var num = fil.insertCell(fil.cells.length);
                                                num.innerHTML = ''; //en rigor, aún no se el número de la página
                                                num.className = 'pag_num';

                                                var sig = fil.insertCell(fil.cells.length);
                                                sig.innerHTML = 'Siguiente';
                                                sig.className = 'pag_btn btn-primary';
                                                sig.onclick = function () {
                                                    if (self.pagActual == self.paginas)
                                                        return;
                                                    self.SetPagina(self.pagActual + 1);
                                                }

                                                //Como ya tengo mi tabla, puedo agregarla al DIV de los controles
                                                this.miDiv.appendChild(tblPaginador);

                                                //¿y esto por qué?
                                                if (this.tabla.rows.length - 1 > this.paginas * this.tamPagina)
                                                    this.paginas = this.paginas + 1;

                                                this.SetPagina(this.pagActual);
                                            }
                                        }
                                    </script>
                                </div>
                                <div id="paginador"></div>
                                @*script2 para paginacion*@
                                <script type="text/javascript">
                                    var p = new Paginador(
                                        document.getElementById('paginador'),
                                        document.getElementById('mytable'),
                                        10
                                    );
                                    p.Mostrar();
                                </script>

                                <!-- FINAL TABLA DE RESULTADOS -->

                            </div>
                            <!-- FINAL RESULTADOS -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- FINAL RESULTADOS DE BUSQUEDA -->
        </div>
    </div>


    @*Jquery, Popper bootstrap.min.js*@
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
    @*este script es para la tabla y filtro de buscado agrupar y paginacion de tabla  el codigo dentro de language es para traducir elementos de la tabla*@
    @*script3 para la paginacion y selector de filas*@
    <script>
        var table = '#mytable'
        $('#maxRows').on('change', function () {
            /*alert('Hola');*/
            $('.pagination').html('')
            var trnum = 0;
            var maxRows = parseInt($(this).val())
            var totalRows = $(table + ' tbody tr').length
            $(table + ' tr:gt(0)').each(function () {
                trnum++
                if (trnum > maxRows) {
                    $(this).hide()
                }
                if (trnum <= maxRows) {
                    $(this).show()
                }
            })
            if (totalRows > maxRows) {
                var pagenum = Math.ceil(totalRows / maxRows)
                for (var i = 1; i <= pagenum;) {
                    $('.pagination').append('<li class="btn" data-page="' + i + '">\<span>' + i++ + '<span class="page-item  sr-only">(current)</span></span>\</li>').show()
                }
            }

            $('.pagination li:first-child').addClass('active')
            $('.pagination li').on('click', function () {
                var pageNum = $(this).attr('date-page')
                var trIndex = 0;
                $('.pagination li').removeClass('active')
                $(this).addClass('active')
                $(table + ' tr:gt(0)').each(function () {
                    trIndex++
                    if (trIndex > (maxRows * pageNum) || trIndex <= ((maxRows * pageNum) - maxRows)) {
                        $(this).hide()
                    } else {
                        $(this).show()
                    }

                })
            })
        })



        @*
        $(function () {
            $('table tr:eq(0)').prepend('<th>ID</th>')
            var id = 0;
            $('table tr:gt(0)').each(function () {
                id++
                $(this).prepend('<td>' + id + '</td>')
            })
        })
        *@
    </script>
</body>
</html>

